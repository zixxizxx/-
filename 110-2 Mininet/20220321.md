### bw、delay、loss
* prpagation delay:距離遠近會影響延遲 
* queueing delay:佇列擁擠程度會影響延遲
* processing time:接收端不會馬上處理
## delay
![image](https://github.com/zixxizxx/Liux-note/blob/main/110-2%20Mininet/image/20220321/0321-2.jpg)
h1到r:1ms，h2到r:1ms
總共delay > 4ms
```
# python 3-1.py
 > xterm h1
 
h1
# ping 192.168.2.1

```
![image](https://github.com/zixxizxx/Liux-note/blob/main/110-2%20Mininet/image/20220321/0321-3.jpg)
h1到r:10ms，h2到r:1ms
總共delay > 22ms
```
# python 3-1.py
 > xterm h1
 
h1
# ping 192.168.2.1

```

## loss rate
* 多媒體傳輸影響大
![image](https://github.com/zixxizxx/Liux-note/blob/main/110-2%20Mininet/image/20220321/0321-4.jpg)
100個封包送過去，不一定會有100個封包送回來，如果有太多資料在傳送，路由器queue有固定長度，queue滿了，封包就會被丟棄。
![image](https://github.com/zixxizxx/Liux-note/blob/main/110-2%20Mininet/image/20220321/0321-5.jpg)
```
# python 3-1.py
 > xterm h1

h1 
# ping -i 0.01 -c 1000 192.168.2.1
```
![image]()


### iperf
## 靜態
等數據跑完在製程圖表
```
# python 3-1.py
 > xterm h1 h2

h2
# iperf -s -i 1 >a

h1
# iperf -c 192.168.2.1 -t 30

h2
# cat a | grep sec | head -n 30 | tr "-" " " | awk '{print $4, $8}' > tcp

# gunplot
 > plot "tcp" with linespoints
```
![image]()
## 動態
資料還在傳可以同時製作圖表
* ```proccess.sh```
```
filename='a'
> result
> a
b="not"
while true
do
   if [ -s "$filename" ]
   then
        #echo "$filename is NOT empty file."
        while IFS= read -r line
        do
          result=`echo "$line" | grep "sec"`
          if [[ -n $result ]]
          then
            #echo $result
            b="done"
            break
          fi
        done < a
   fi
 
   if [ $b = "done" ]
   then
     break
   fi
done
 
while IFS= read -r line
do
  result=`echo "$line" | grep "sec" | tr "-" " " | awk '{print $4,$8}'`
  if [[ -n $result ]]
  then
    echo $result
    echo $result >> result
    sleep 1
  fi
done < afilename='a'
> result
> a
b="not"
while true
do
   if [ -s "$filename" ]
   then
        #echo "$filename is NOT empty file."
        while IFS= read -r line
        do
          result=`echo "$line" | grep "sec"`
          if [[ -n $result ]]
          then
            #echo $result
            b="done"
            break
          fi
        done < a
   fi
 
   if [ $b = "done" ]
   then
     break
   fi
done
 
while IFS= read -r line
do
  result=`echo "$line" | grep "sec" | tr "-" " " | awk '{print $4,$8}'`
  if [[ -n $result ]]
  then
    echo $result
    echo $result >> result
    sleep 1
  fi
done < a

```

* ```gunplot-plot```
```
FILE = 'result'
stop = 0
 
N = 10
set yrange [0:100]
set ytics 0,10,100
set key off
set xlabel "time(sec)"
set ylabel "Throughput(Mbps)"

while (!stop) {  

    pause 0.5       # pause in seconds
    stats [*:*][*:*] FILE u 0 nooutput
    lPnts=STATS_records<N ? 0: STATS_records-N
    plot FILE u 1:2 every ::lPnts w lp pt 7
}

```

* ```plot-throughput.sh```
```
filename='result'
while true
do
   if [ -s "$filename" ]
   then
        #echo "$filename is NOT empty file."
        break
   fi
done

gnuplot gnuplot-plot

```
清除空白行
```
# sed -i '/^$/d' proccess.sh
# sed -i '/^$/d' gunplot-plot
# sed -i '/^$/d' plot-throughput.sh
```
加可執行權限
```
# chmod +x  proccess.sh
# chmod +x  gunplot-plot
# chmod +x  plot-throughput.sh
```
開始執行
```
> xterm h1 h2 h2 h2

h2
# ./proccess.sh

h2
# ./plot-throughput.sh

h2
# iperf -s -i 1 >a

h1
# iperf -c 192.168.2.1 -t 100
```

![image](https://github.com/zixxizxx/Liux-note/blob/main/110-2%20Mininet/image/20220321/0321-1.jpg)

## Vlan
* 拓撲圖
![image](https://github.com/zixxizxx/Liux-note/blob/main/110-2%20Mininet/image/20220321/0321-6.jpg)

```
# python 3.py
 > net
 > h1 ping h2 
 > h1 ping h3、h4
```










